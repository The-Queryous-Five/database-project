{% extends "base.html" %}

{% block title %}High Value Customers - Olist Analytics{% endblock %}

{% block content %}
<h1>High Value Customers</h1>
<p>Customers whose total payment is greater than the average customer total payment. Uses nested subqueries.</p>

{% if error %}
<div style="background: #fee; color: #c33; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
    Error: {{ error }}
</div>
{% endif %}

{% if results %}
<table>
    <thead>
        <tr>
            <th>Customer ID</th>
            <th>City</th>
            <th>State</th>
            <th>Total Spent</th>
        </tr>
    </thead>
    <tbody>
        {% for row in results %}
        <tr>
            <td>{{ row.customer_id }}</td>
            <td>{{ row.customer_city or 'N/A' }}</td>
            <td>{{ row.customer_state or 'N/A' }}</td>
            <td>R$ {{ "%.2f"|format(row.total_spent) if row.total_spent else '0.00' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No data available.</p>
{% endif %}
{% endblock %}
